module.exports = {

"[project]/.next-internal/server/app/api/health/route/actions.js [app-rsc] (server actions loader, ecmascript)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/process [external] (process, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("process", () => require("process"));

module.exports = mod;
}}),
"[externals]/tls [external] (tls, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}}),
"[externals]/fs [external] (fs, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}}),
"[externals]/os [external] (os, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}}),
"[externals]/net [external] (net, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/path [external] (path, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}}),
"[externals]/http2 [external] (http2, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http2", () => require("http2"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/dns [external] (dns, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("dns", () => require("dns"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[project]/src/lib/firebase.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "COLLECTIONS": ()=>COLLECTIONS,
    "auth": ()=>auth,
    "cleanupExpiredSessions": ()=>cleanupExpiredSessions,
    "convertTimestamp": ()=>convertTimestamp,
    "convertToTimestamp": ()=>convertToTimestamp,
    "createApiCredentials": ()=>createApiCredentials,
    "createOAuthSession": ()=>createOAuthSession,
    "createUser": ()=>createUser,
    "db": ()=>db,
    "default": ()=>__TURBOPACK__default__export__,
    "deleteApiCredentials": ()=>deleteApiCredentials,
    "getAccessToken": ()=>getAccessToken,
    "getApiCredentials": ()=>getApiCredentials,
    "getApiCredentialsByClientId": ()=>getApiCredentialsByClientId,
    "getOAuthSession": ()=>getOAuthSession,
    "getUser": ()=>getUser,
    "getUserApiCredentials": ()=>getUserApiCredentials,
    "getUserByEmail": ()=>getUserByEmail,
    "googleProvider": ()=>googleProvider,
    "logSecurityEvent": ()=>logSecurityEvent,
    "onAuthStateChange": ()=>onAuthStateChange,
    "recordUsageStats": ()=>recordUsageStats,
    "revokeAccessToken": ()=>revokeAccessToken,
    "signInWithGoogle": ()=>signInWithGoogle,
    "signOutUser": ()=>signOutUser,
    "updateApiCredentials": ()=>updateApiCredentials,
    "updateOAuthSession": ()=>updateOAuthSession,
    "updateUser": ()=>updateUser
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$firebase$2f$app$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/firebase/app/dist/index.mjs [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$app$2f$dist$2f$esm$2f$index$2e$esm$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@firebase/app/dist/esm/index.esm.js [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$firebase$2f$auth$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/firebase/auth/dist/index.mjs [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__p__as__getAuth$3e$__ = __turbopack_context__.i("[project]/node_modules/@firebase/auth/dist/node-esm/totp-13844f55.js [app-route] (ecmascript) <export p as getAuth>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__Y__as__GoogleAuthProvider$3e$__ = __turbopack_context__.i("[project]/node_modules/@firebase/auth/dist/node-esm/totp-13844f55.js [app-route] (ecmascript) <export Y as GoogleAuthProvider>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__d__as__signInWithPopup$3e$__ = __turbopack_context__.i("[project]/node_modules/@firebase/auth/dist/node-esm/totp-13844f55.js [app-route] (ecmascript) <export d as signInWithPopup>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__D__as__signOut$3e$__ = __turbopack_context__.i("[project]/node_modules/@firebase/auth/dist/node-esm/totp-13844f55.js [app-route] (ecmascript) <export D as signOut>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__z__as__onAuthStateChanged$3e$__ = __turbopack_context__.i("[project]/node_modules/@firebase/auth/dist/node-esm/totp-13844f55.js [app-route] (ecmascript) <export z as onAuthStateChanged>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$firebase$2f$firestore$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/firebase/firestore/dist/index.mjs [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@firebase/firestore/dist/index.node.mjs [app-route] (ecmascript)");
;
;
;
// Firebase Client Configuration
const firebaseConfig = {
    apiKey: ("TURBOPACK compile-time value", "AIzaSyDAupXvxYn4UQQmqPxUQGYwQ551N20ILpk"),
    authDomain: ("TURBOPACK compile-time value", "itdiary-ase.firebaseapp.com"),
    projectId: ("TURBOPACK compile-time value", "itdiary-ase"),
    storageBucket: ("TURBOPACK compile-time value", "itdiary-ase.firebasestorage.app"),
    messagingSenderId: ("TURBOPACK compile-time value", "889720897004"),
    appId: ("TURBOPACK compile-time value", "1:889720897004:web:c614ece867e0cb6f0a94c9")
};
// Initialize Firebase Client
let app;
if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$app$2f$dist$2f$esm$2f$index$2e$esm$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["getApps"])().length) {
    app = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$app$2f$dist$2f$esm$2f$index$2e$esm$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["initializeApp"])(firebaseConfig);
} else {
    app = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$app$2f$dist$2f$esm$2f$index$2e$esm$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["getApps"])()[0];
}
const auth = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__p__as__getAuth$3e$__["getAuth"])(app);
const db = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getFirestore"])(app);
const googleProvider = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__Y__as__GoogleAuthProvider$3e$__["GoogleAuthProvider"]();
const COLLECTIONS = {
    USERS: "users",
    API_CREDENTIALS: "api_credentials",
    OAUTH_SESSIONS: "oauth_sessions",
    USAGE_STATS: "usage_stats",
    SECURITY_LOGS: "security_logs",
    ACCESS_TOKENS: "access_tokens"
};
const convertTimestamp = (timestamp)=>{
    if (timestamp instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Timestamp"]) {
        return timestamp.toDate();
    }
    return timestamp;
};
const convertToTimestamp = (date)=>{
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Timestamp"].fromDate(date);
};
const signInWithGoogle = async ()=>{
    try {
        const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__d__as__signInWithPopup$3e$__["signInWithPopup"])(auth, googleProvider);
        return result.user;
    } catch (error) {
        console.error("Error signing in with Google:", error);
        return null;
    }
};
const signOutUser = async ()=>{
    try {
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__D__as__signOut$3e$__["signOut"])(auth);
    } catch (error) {
        console.error("Error signing out:", error);
    }
};
const onAuthStateChange = (callback)=>{
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__z__as__onAuthStateChanged$3e$__["onAuthStateChanged"])(auth, callback);
};
const createUser = async (userData)=>{
    const newUser = {
        ...userData,
        createdAt: convertToTimestamp(new Date()),
        updatedAt: convertToTimestamp(new Date())
    };
    const userRef = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(db, COLLECTIONS.USERS), newUser);
    return userRef.id;
};
const getUser = async (userId)=>{
    const userDoc = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.USERS, userId));
    if (!userDoc.exists()) return null;
    const data = userDoc.data();
    return {
        ...data,
        id: userDoc.id,
        createdAt: convertTimestamp(data.createdAt),
        updatedAt: convertTimestamp(data.updatedAt)
    };
};
const getUserByEmail = async (email)=>{
    const q = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["query"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(db, COLLECTIONS.USERS), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["where"])("email", "==", email), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["limit"])(1));
    const querySnapshot = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDocs"])(q);
    if (querySnapshot.empty) return null;
    const userDoc = querySnapshot.docs[0];
    const data = userDoc.data();
    return {
        ...data,
        id: userDoc.id,
        createdAt: convertTimestamp(data.createdAt),
        updatedAt: convertTimestamp(data.updatedAt)
    };
};
const updateUser = async (userId, updates)=>{
    const userRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.USERS, userId);
    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["updateDoc"])(userRef, {
        ...updates,
        updatedAt: convertToTimestamp(new Date())
    });
};
const createApiCredentials = async (credentialsData)=>{
    const newCredentials = {
        ...credentialsData,
        createdAt: convertToTimestamp(new Date()),
        updatedAt: convertToTimestamp(new Date())
    };
    const credRef = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(db, COLLECTIONS.API_CREDENTIALS), newCredentials);
    return credRef.id;
};
const getApiCredentials = async (credentialId)=>{
    const credDoc = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.API_CREDENTIALS, credentialId));
    if (!credDoc.exists()) return null;
    const data = credDoc.data();
    return {
        ...data,
        id: credDoc.id,
        createdAt: convertTimestamp(data.createdAt),
        updatedAt: convertTimestamp(data.updatedAt)
    };
};
const getApiCredentialsByClientId = async (clientId)=>{
    const q = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["query"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(db, COLLECTIONS.API_CREDENTIALS), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["where"])("clientId", "==", clientId), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["limit"])(1));
    const querySnapshot = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDocs"])(q);
    if (querySnapshot.empty) return null;
    const credDoc = querySnapshot.docs[0];
    const data = credDoc.data();
    return {
        ...data,
        id: credDoc.id,
        createdAt: convertTimestamp(data.createdAt),
        updatedAt: convertTimestamp(data.updatedAt)
    };
};
const getUserApiCredentials = async (userId)=>{
    const q = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["query"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(db, COLLECTIONS.API_CREDENTIALS), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["where"])("userId", "==", userId), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orderBy"])("createdAt", "desc"));
    const querySnapshot = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDocs"])(q);
    return querySnapshot.docs.map((doc)=>{
        const data = doc.data();
        return {
            ...data,
            id: doc.id,
            createdAt: convertTimestamp(data.createdAt),
            updatedAt: convertTimestamp(data.updatedAt)
        };
    });
};
const updateApiCredentials = async (credentialId, updates)=>{
    const credRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.API_CREDENTIALS, credentialId);
    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["updateDoc"])(credRef, {
        ...updates,
        updatedAt: convertToTimestamp(new Date())
    });
};
const deleteApiCredentials = async (credentialId)=>{
    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.API_CREDENTIALS, credentialId));
};
const getAccessToken = async (token)=>{
    const tokenDoc = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.ACCESS_TOKENS, token));
    if (!tokenDoc.exists()) return null;
    const data = tokenDoc.data();
    // The document ID is the token itself.
    return {
        token: tokenDoc.id,
        userId: data.userId,
        credentialId: data.credentialId,
        sessionId: data.sessionId,
        scopes: data.scopes,
        tokenType: data.tokenType,
        isRevoked: data.isRevoked,
        createdAt: convertTimestamp(data.createdAt),
        expiresAt: convertTimestamp(data.expiresAt)
    };
};
const revokeAccessToken = async (token)=>{
    const tokenRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.ACCESS_TOKENS, token);
    // Check if the document exists before updating to avoid creating new documents.
    const tokenSnap = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDoc"])(tokenRef);
    if (tokenSnap.exists()) {
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["updateDoc"])(tokenRef, {
            isRevoked: true
        });
    }
};
const createOAuthSession = async (sessionData)=>{
    const newSession = {
        ...sessionData,
        createdAt: convertToTimestamp(new Date()),
        expiresAt: convertToTimestamp(sessionData.expiresAt)
    };
    const sessionRef = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(db, COLLECTIONS.OAUTH_SESSIONS), newSession);
    return sessionRef.id;
};
const getOAuthSession = async (sessionId)=>{
    const sessionDoc = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.OAUTH_SESSIONS, sessionId));
    if (!sessionDoc.exists()) return null;
    const data = sessionDoc.data();
    return {
        ...data,
        createdAt: convertTimestamp(data.createdAt),
        expiresAt: convertTimestamp(data.expiresAt),
        authorizedAt: data.authorizedAt ? convertTimestamp(data.authorizedAt) : undefined,
        tokenExpiresAt: data.tokenExpiresAt ? convertTimestamp(data.tokenExpiresAt) : undefined
    };
};
const updateOAuthSession = async (sessionId, updates)=>{
    const updateData = {
        ...updates
    };
    if (updates.expiresAt) {
        updateData.expiresAt = convertToTimestamp(updates.expiresAt);
    }
    if (updates.authorizedAt) {
        updateData.authorizedAt = convertToTimestamp(updates.authorizedAt);
    }
    if (updates.tokenExpiresAt) {
        updateData.tokenExpiresAt = convertToTimestamp(updates.tokenExpiresAt);
    }
    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["updateDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.OAUTH_SESSIONS, sessionId), updateData);
};
const recordUsageStats = async (credentialId, success)=>{
    const today = new Date().toISOString().split("T")[0];
    const statsId = `${credentialId}_${today}`;
    const statsRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.USAGE_STATS, statsId);
    const statsDoc = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDoc"])(statsRef);
    if (statsDoc.exists()) {
        const currentData = statsDoc.data();
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["updateDoc"])(statsRef, {
            requests: currentData.requests + 1,
            errors: success ? currentData.errors : currentData.errors + 1,
            successfulAuths: success ? currentData.successfulAuths + 1 : currentData.successfulAuths,
            failedAuths: success ? currentData.failedAuths : currentData.failedAuths + 1,
            lastRequest: convertToTimestamp(new Date())
        });
    } else {
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["setDoc"])(statsRef, {
            credentialId,
            date: today,
            requests: 1,
            errors: success ? 0 : 1,
            successfulAuths: success ? 1 : 0,
            failedAuths: success ? 0 : 1,
            lastRequest: convertToTimestamp(new Date())
        });
    }
};
const logSecurityEvent = async (logData)=>{
    const logDoc = {
        ...logData,
        timestamp: convertToTimestamp(new Date())
    };
    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(db, COLLECTIONS.SECURITY_LOGS), logDoc);
};
const cleanupExpiredSessions = async ()=>{
    const now = new Date();
    const expiredSessionsQuery = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["query"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(db, COLLECTIONS.OAUTH_SESSIONS), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["where"])("expiresAt", "<", convertToTimestamp(now)));
    const expiredSessions = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDocs"])(expiredSessionsQuery);
    const deletePromises = expiredSessions.docs.map((doc)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteDoc"])(doc.ref));
    await Promise.all(deletePromises);
};
const __TURBOPACK__default__export__ = {
    auth,
    db,
    googleProvider,
    signInWithGoogle,
    signOutUser,
    onAuthStateChange,
    createUser,
    getUser,
    getUserByEmail,
    updateUser,
    createApiCredentials,
    getApiCredentials,
    getApiCredentialsByClientId,
    getUserApiCredentials,
    updateApiCredentials,
    deleteApiCredentials,
    getAccessToken,
    revokeAccessToken,
    createOAuthSession,
    getOAuthSession,
    updateOAuthSession,
    recordUsageStats,
    logSecurityEvent,
    cleanupExpiredSessions
};
}),
"[project]/src/app/api/health/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "GET": ()=>GET,
    "HEAD": ()=>HEAD
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/firebase.ts [app-route] (ecmascript)");
;
;
async function GET(request) {
    const startTime = Date.now();
    try {
        // Basic environment check
        const environment = {
            node_env: ("TURBOPACK compile-time value", "development"),
            app_url: process.env.APP_URL,
            app_domain: process.env.APP_DOMAIN,
            nextauth_url: process.env.NEXTAUTH_URL,
            firebase_project: process.env.FIREBASE_PROJECT_ID,
            has_jwt_secret: !!process.env.JWT_SECRET,
            has_encryption_key: !!process.env.ENCRYPTION_KEY,
            has_nextauth_secret: !!process.env.NEXTAUTH_SECRET
        };
        // Test admin services
        const adminDb1 = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getAdminDb"])();
        const adminAuth1 = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getAdminAuth"])();
        // Firebase configuration check
        const firebase = {
            client: {
                has_api_key: !!("TURBOPACK compile-time value", "AIzaSyDAupXvxYn4UQQmqPxUQGYwQ551N20ILpk"),
                has_auth_domain: !!("TURBOPACK compile-time value", "itdiary-ase.firebaseapp.com"),
                has_project_id: !!("TURBOPACK compile-time value", "itdiary-ase"),
                has_storage_bucket: !!("TURBOPACK compile-time value", "itdiary-ase.firebasestorage.app"),
                has_messaging_sender_id: !!("TURBOPACK compile-time value", "889720897004"),
                has_app_id: !!("TURBOPACK compile-time value", "1:889720897004:web:c614ece867e0cb6f0a94c9"),
                auth_initialized: ("TURBOPACK compile-time falsy", 0) ? "TURBOPACK unreachable" : "server-side",
                db_initialized: ("TURBOPACK compile-time falsy", 0) ? "TURBOPACK unreachable" : "server-side"
            },
            admin: {
                has_project_id: !!process.env.FIREBASE_PROJECT_ID,
                has_client_email: !!process.env.FIREBASE_CLIENT_EMAIL,
                has_private_key: !!process.env.FIREBASE_PRIVATE_KEY,
                admin_auth_initialized: !!adminAuth1,
                admin_db_initialized: !!adminDb1
            }
        };
        // Test database connectivity
        let databaseTests = {
            admin_db_connection: false,
            admin_auth_connection: false,
            collections_accessible: false,
            error: null
        };
        try {
            if (adminDb1) {
                // Test Firestore connection
                await adminDb1.collection("_health_check").limit(1).get();
                databaseTests.admin_db_connection = true;
                databaseTests.collections_accessible = true;
            }
            if (adminAuth1) {
                // Test Auth connection by checking if we can access the service
                await adminAuth1.listUsers(1);
                databaseTests.admin_auth_connection = true;
            }
        } catch (error) {
            databaseTests.error = error instanceof Error ? error.message : "Unknown database error";
        }
        // Rate limiting configuration
        const rateLimiting = {
            max_requests: process.env.RATE_LIMIT_MAX_REQUESTS || "100",
            window_ms: process.env.RATE_LIMIT_WINDOW_MS || "900000",
            enabled: process.env.SKIP_RATE_LIMIT !== "true"
        };
        // OAuth configuration
        const oauth = {
            session_expiry_minutes: process.env.SESSION_EXPIRY_MINUTES || "10",
            auth_code_expiry_minutes: process.env.AUTH_CODE_EXPIRY_MINUTES || "10",
            access_token_expiry_minutes: process.env.ACCESS_TOKEN_EXPIRY_MINUTES || "60",
            refresh_token_expiry_days: process.env.REFRESH_TOKEN_EXPIRY_DAYS || "30",
            tunnel_domain: process.env.TUNNEL_DOMAIN || null
        };
        // Security configuration
        const security = {
            csp_enabled: process.env.CSP_ENABLED === "true",
            cors_origins: process.env.CORS_ORIGINS || "http://localhost:3000",
            force_https: process.env.FORCE_HTTPS === "true",
            security_logging: process.env.SECURITY_LOGGING !== "false"
        };
        // Overall health status
        const criticalIssues = [];
        if (!firebase.admin.admin_db_initialized) {
            criticalIssues.push("Firebase Admin Firestore not initialized");
        }
        if (!firebase.admin.admin_auth_initialized) {
            criticalIssues.push("Firebase Admin Auth not initialized");
        }
        if (!environment.has_jwt_secret) {
            criticalIssues.push("JWT_SECRET not configured");
        }
        if (!environment.has_encryption_key) {
            criticalIssues.push("ENCRYPTION_KEY not configured");
        }
        if (!databaseTests.admin_db_connection) {
            criticalIssues.push("Database connection failed");
        }
        const warnings = [];
        if (!oauth.tunnel_domain && environment.node_env === "development") {
            warnings.push("TUNNEL_DOMAIN not set - OAuth callbacks may not work in development");
        }
        if (!environment.has_nextauth_secret) {
            warnings.push("NEXTAUTH_SECRET not configured");
        }
        const overallStatus = criticalIssues.length === 0 ? warnings.length === 0 ? "healthy" : "healthy_with_warnings" : "unhealthy";
        const endTime = Date.now();
        const responseTime = endTime - startTime;
        const healthCheck = {
            status: overallStatus,
            timestamp: new Date().toISOString(),
            response_time_ms: responseTime,
            version: "1.0.0",
            system: {
                environment,
                firebase,
                database_tests: databaseTests,
                rate_limiting: rateLimiting,
                oauth,
                security
            },
            issues: {
                critical: criticalIssues,
                warnings
            },
            endpoints: {
                authorization: `${environment.app_url}/api/oauth/authorize`,
                token: `${environment.app_url}/api/oauth/token`,
                userinfo: `${environment.app_url}/api/oauth/userinfo`,
                dashboard: `${environment.app_url}/dashboard`
            },
            next_steps: criticalIssues.length > 0 ? [
                "Fix critical issues listed above",
                "Check Firebase Admin SDK configuration",
                "Verify environment variables are set correctly",
                "Refer to SETUP_GUIDE.md for detailed instructions"
            ] : [
                "System is ready for OAuth operations",
                "Create your first API credentials in the dashboard",
                "Test the OAuth flow with a sample application",
                "Configure production settings when ready"
            ]
        };
        // Set appropriate status code
        const statusCode = overallStatus === "unhealthy" ? 503 : 200;
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(healthCheck, {
            status: statusCode,
            headers: {
                "Cache-Control": "no-cache, no-store, must-revalidate",
                Pragma: "no-cache",
                Expires: "0"
            }
        });
    } catch (error) {
        console.error("Health check failed:", error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            status: "error",
            timestamp: new Date().toISOString(),
            error: error instanceof Error ? error.message : "Unknown error occurred",
            message: "Health check endpoint encountered an error",
            suggestion: "Check server logs and verify your configuration"
        }, {
            status: 500,
            headers: {
                "Cache-Control": "no-cache, no-store, must-revalidate",
                Pragma: "no-cache",
                Expires: "0"
            }
        });
    }
}
async function HEAD(request) {
    try {
        const isHealthy = !!adminDb && !!adminAuth;
        return new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"](null, {
            status: isHealthy ? 200 : 503,
            headers: {
                "Cache-Control": "no-cache, no-store, must-revalidate"
            }
        });
    } catch  {
        return new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"](null, {
            status: 503
        });
    }
}
}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__58791023._.js.map