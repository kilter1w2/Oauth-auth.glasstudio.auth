module.exports = {

"[project]/.next-internal/server/app/api/credentials/route/actions.js [app-rsc] (server actions loader, ecmascript)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/process [external] (process, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("process", () => require("process"));

module.exports = mod;
}}),
"[externals]/tls [external] (tls, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}}),
"[externals]/fs [external] (fs, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}}),
"[externals]/os [external] (os, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}}),
"[externals]/net [external] (net, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/path [external] (path, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}}),
"[externals]/http2 [external] (http2, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http2", () => require("http2"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/dns [external] (dns, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("dns", () => require("dns"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[project]/src/lib/firebase.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "COLLECTIONS": ()=>COLLECTIONS,
    "auth": ()=>auth,
    "cleanupExpiredSessions": ()=>cleanupExpiredSessions,
    "convertTimestamp": ()=>convertTimestamp,
    "convertToTimestamp": ()=>convertToTimestamp,
    "createApiCredentials": ()=>createApiCredentials,
    "createOAuthSession": ()=>createOAuthSession,
    "createUser": ()=>createUser,
    "db": ()=>db,
    "default": ()=>__TURBOPACK__default__export__,
    "deleteApiCredentials": ()=>deleteApiCredentials,
    "getApiCredentials": ()=>getApiCredentials,
    "getApiCredentialsByClientId": ()=>getApiCredentialsByClientId,
    "getOAuthSession": ()=>getOAuthSession,
    "getUser": ()=>getUser,
    "getUserApiCredentials": ()=>getUserApiCredentials,
    "getUserByEmail": ()=>getUserByEmail,
    "googleProvider": ()=>googleProvider,
    "logSecurityEvent": ()=>logSecurityEvent,
    "onAuthStateChange": ()=>onAuthStateChange,
    "recordUsageStats": ()=>recordUsageStats,
    "signInWithGoogle": ()=>signInWithGoogle,
    "signOutUser": ()=>signOutUser,
    "updateApiCredentials": ()=>updateApiCredentials,
    "updateOAuthSession": ()=>updateOAuthSession,
    "updateUser": ()=>updateUser
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$firebase$2f$app$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/firebase/app/dist/index.mjs [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$app$2f$dist$2f$esm$2f$index$2e$esm$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@firebase/app/dist/esm/index.esm.js [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$firebase$2f$auth$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/firebase/auth/dist/index.mjs [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__p__as__getAuth$3e$__ = __turbopack_context__.i("[project]/node_modules/@firebase/auth/dist/node-esm/totp-13844f55.js [app-route] (ecmascript) <export p as getAuth>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__Y__as__GoogleAuthProvider$3e$__ = __turbopack_context__.i("[project]/node_modules/@firebase/auth/dist/node-esm/totp-13844f55.js [app-route] (ecmascript) <export Y as GoogleAuthProvider>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__d__as__signInWithPopup$3e$__ = __turbopack_context__.i("[project]/node_modules/@firebase/auth/dist/node-esm/totp-13844f55.js [app-route] (ecmascript) <export d as signInWithPopup>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__D__as__signOut$3e$__ = __turbopack_context__.i("[project]/node_modules/@firebase/auth/dist/node-esm/totp-13844f55.js [app-route] (ecmascript) <export D as signOut>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__z__as__onAuthStateChanged$3e$__ = __turbopack_context__.i("[project]/node_modules/@firebase/auth/dist/node-esm/totp-13844f55.js [app-route] (ecmascript) <export z as onAuthStateChanged>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$firebase$2f$firestore$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/firebase/firestore/dist/index.mjs [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@firebase/firestore/dist/index.node.mjs [app-route] (ecmascript)");
;
;
;
// Firebase Client Configuration
const firebaseConfig = {
    apiKey: ("TURBOPACK compile-time value", "AIzaSyDAupXvxYn4UQQmqPxUQGYwQ551N20ILpk"),
    authDomain: ("TURBOPACK compile-time value", "itdiary-ase.firebaseapp.com"),
    projectId: ("TURBOPACK compile-time value", "itdiary-ase"),
    storageBucket: ("TURBOPACK compile-time value", "itdiary-ase.firebasestorage.app"),
    messagingSenderId: ("TURBOPACK compile-time value", "889720897004"),
    appId: ("TURBOPACK compile-time value", "1:889720897004:web:c614ece867e0cb6f0a94c9")
};
// Initialize Firebase Client
let app;
if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$app$2f$dist$2f$esm$2f$index$2e$esm$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["getApps"])().length) {
    app = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$app$2f$dist$2f$esm$2f$index$2e$esm$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["initializeApp"])(firebaseConfig);
} else {
    app = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$app$2f$dist$2f$esm$2f$index$2e$esm$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["getApps"])()[0];
}
const auth = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__p__as__getAuth$3e$__["getAuth"])(app);
const db = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getFirestore"])(app);
const googleProvider = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__Y__as__GoogleAuthProvider$3e$__["GoogleAuthProvider"]();
const COLLECTIONS = {
    USERS: "users",
    API_CREDENTIALS: "api_credentials",
    OAUTH_SESSIONS: "oauth_sessions",
    USAGE_STATS: "usage_stats",
    SECURITY_LOGS: "security_logs"
};
const convertTimestamp = (timestamp)=>{
    if (timestamp instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Timestamp"]) {
        return timestamp.toDate();
    }
    return timestamp;
};
const convertToTimestamp = (date)=>{
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Timestamp"].fromDate(date);
};
const signInWithGoogle = async ()=>{
    try {
        const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__d__as__signInWithPopup$3e$__["signInWithPopup"])(auth, googleProvider);
        return result.user;
    } catch (error) {
        console.error("Error signing in with Google:", error);
        return null;
    }
};
const signOutUser = async ()=>{
    try {
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__D__as__signOut$3e$__["signOut"])(auth);
    } catch (error) {
        console.error("Error signing out:", error);
    }
};
const onAuthStateChange = (callback)=>{
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$auth$2f$dist$2f$node$2d$esm$2f$totp$2d$13844f55$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__z__as__onAuthStateChanged$3e$__["onAuthStateChanged"])(auth, callback);
};
const createUser = async (userData)=>{
    const newUser = {
        ...userData,
        createdAt: convertToTimestamp(new Date()),
        updatedAt: convertToTimestamp(new Date())
    };
    const userRef = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(db, COLLECTIONS.USERS), newUser);
    return userRef.id;
};
const getUser = async (userId)=>{
    const userDoc = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.USERS, userId));
    if (!userDoc.exists()) return null;
    const data = userDoc.data();
    return {
        ...data,
        id: userDoc.id,
        createdAt: convertTimestamp(data.createdAt),
        updatedAt: convertTimestamp(data.updatedAt)
    };
};
const getUserByEmail = async (email)=>{
    const q = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["query"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(db, COLLECTIONS.USERS), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["where"])("email", "==", email), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["limit"])(1));
    const querySnapshot = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDocs"])(q);
    if (querySnapshot.empty) return null;
    const userDoc = querySnapshot.docs[0];
    const data = userDoc.data();
    return {
        ...data,
        id: userDoc.id,
        createdAt: convertTimestamp(data.createdAt),
        updatedAt: convertTimestamp(data.updatedAt)
    };
};
const updateUser = async (userId, updates)=>{
    const userRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.USERS, userId);
    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["updateDoc"])(userRef, {
        ...updates,
        updatedAt: convertToTimestamp(new Date())
    });
};
const createApiCredentials = async (credentialsData)=>{
    const newCredentials = {
        ...credentialsData,
        createdAt: convertToTimestamp(new Date()),
        updatedAt: convertToTimestamp(new Date())
    };
    const credRef = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(db, COLLECTIONS.API_CREDENTIALS), newCredentials);
    return credRef.id;
};
const getApiCredentials = async (credentialId)=>{
    const credDoc = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.API_CREDENTIALS, credentialId));
    if (!credDoc.exists()) return null;
    const data = credDoc.data();
    return {
        ...data,
        id: credDoc.id,
        createdAt: convertTimestamp(data.createdAt),
        updatedAt: convertTimestamp(data.updatedAt)
    };
};
const getApiCredentialsByClientId = async (clientId)=>{
    const q = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["query"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(db, COLLECTIONS.API_CREDENTIALS), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["where"])("clientId", "==", clientId), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["limit"])(1));
    const querySnapshot = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDocs"])(q);
    if (querySnapshot.empty) return null;
    const credDoc = querySnapshot.docs[0];
    const data = credDoc.data();
    return {
        ...data,
        id: credDoc.id,
        createdAt: convertTimestamp(data.createdAt),
        updatedAt: convertTimestamp(data.updatedAt)
    };
};
const getUserApiCredentials = async (userId)=>{
    const q = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["query"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(db, COLLECTIONS.API_CREDENTIALS), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["where"])("userId", "==", userId), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orderBy"])("createdAt", "desc"));
    const querySnapshot = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDocs"])(q);
    return querySnapshot.docs.map((doc)=>{
        const data = doc.data();
        return {
            ...data,
            id: doc.id,
            createdAt: convertTimestamp(data.createdAt),
            updatedAt: convertTimestamp(data.updatedAt)
        };
    });
};
const updateApiCredentials = async (credentialId, updates)=>{
    const credRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.API_CREDENTIALS, credentialId);
    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["updateDoc"])(credRef, {
        ...updates,
        updatedAt: convertToTimestamp(new Date())
    });
};
const deleteApiCredentials = async (credentialId)=>{
    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.API_CREDENTIALS, credentialId));
};
const createOAuthSession = async (sessionData)=>{
    const newSession = {
        ...sessionData,
        createdAt: convertToTimestamp(new Date()),
        expiresAt: convertToTimestamp(sessionData.expiresAt)
    };
    const sessionRef = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(db, COLLECTIONS.OAUTH_SESSIONS), newSession);
    return sessionRef.id;
};
const getOAuthSession = async (sessionId)=>{
    const sessionDoc = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.OAUTH_SESSIONS, sessionId));
    if (!sessionDoc.exists()) return null;
    const data = sessionDoc.data();
    return {
        ...data,
        createdAt: convertTimestamp(data.createdAt),
        expiresAt: convertTimestamp(data.expiresAt),
        authorizedAt: data.authorizedAt ? convertTimestamp(data.authorizedAt) : undefined,
        tokenExpiresAt: data.tokenExpiresAt ? convertTimestamp(data.tokenExpiresAt) : undefined
    };
};
const updateOAuthSession = async (sessionId, updates)=>{
    const updateData = {
        ...updates
    };
    if (updates.expiresAt) {
        updateData.expiresAt = convertToTimestamp(updates.expiresAt);
    }
    if (updates.authorizedAt) {
        updateData.authorizedAt = convertToTimestamp(updates.authorizedAt);
    }
    if (updates.tokenExpiresAt) {
        updateData.tokenExpiresAt = convertToTimestamp(updates.tokenExpiresAt);
    }
    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["updateDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.OAUTH_SESSIONS, sessionId), updateData);
};
const recordUsageStats = async (credentialId, success)=>{
    const today = new Date().toISOString().split("T")[0];
    const statsId = `${credentialId}_${today}`;
    const statsRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(db, COLLECTIONS.USAGE_STATS, statsId);
    const statsDoc = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDoc"])(statsRef);
    if (statsDoc.exists()) {
        const currentData = statsDoc.data();
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["updateDoc"])(statsRef, {
            requests: currentData.requests + 1,
            errors: success ? currentData.errors : currentData.errors + 1,
            successfulAuths: success ? currentData.successfulAuths + 1 : currentData.successfulAuths,
            failedAuths: success ? currentData.failedAuths : currentData.failedAuths + 1,
            lastRequest: convertToTimestamp(new Date())
        });
    } else {
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["setDoc"])(statsRef, {
            credentialId,
            date: today,
            requests: 1,
            errors: success ? 0 : 1,
            successfulAuths: success ? 1 : 0,
            failedAuths: success ? 0 : 1,
            lastRequest: convertToTimestamp(new Date())
        });
    }
};
const logSecurityEvent = async (logData)=>{
    const logDoc = {
        ...logData,
        timestamp: convertToTimestamp(new Date())
    };
    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addDoc"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(db, COLLECTIONS.SECURITY_LOGS), logDoc);
};
const cleanupExpiredSessions = async ()=>{
    const now = new Date();
    const expiredSessionsQuery = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["query"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(db, COLLECTIONS.OAUTH_SESSIONS), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["where"])("expiresAt", "<", convertToTimestamp(now)));
    const expiredSessions = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDocs"])(expiredSessionsQuery);
    const deletePromises = expiredSessions.docs.map((doc)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteDoc"])(doc.ref));
    await Promise.all(deletePromises);
};
const __TURBOPACK__default__export__ = {
    auth,
    db,
    googleProvider,
    signInWithGoogle,
    signOutUser,
    onAuthStateChange,
    createUser,
    getUser,
    getUserByEmail,
    updateUser,
    createApiCredentials,
    getApiCredentials,
    getApiCredentialsByClientId,
    getUserApiCredentials,
    updateApiCredentials,
    deleteApiCredentials,
    createOAuthSession,
    getOAuthSession,
    updateOAuthSession,
    recordUsageStats,
    logSecurityEvent,
    cleanupExpiredSessions
};
}),
"[externals]/buffer [external] (buffer, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[externals]/node:crypto [external] (node:crypto, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:crypto", () => require("node:crypto"));

module.exports = mod;
}}),
"[project]/src/lib/utils.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "addDays": ()=>addDays,
    "addHours": ()=>addHours,
    "addMinutes": ()=>addMinutes,
    "calculateRateLimit": ()=>calculateRateLimit,
    "createErrorResponse": ()=>createErrorResponse,
    "createOAuthError": ()=>createOAuthError,
    "createSecurityLogData": ()=>createSecurityLogData,
    "createSuccessResponse": ()=>createSuccessResponse,
    "decodeJWT": ()=>decodeJWT,
    "decrypt": ()=>decrypt,
    "default": ()=>__TURBOPACK__default__export__,
    "encrypt": ()=>encrypt,
    "generateAccessToken": ()=>generateAccessToken,
    "generateApiKey": ()=>generateApiKey,
    "generateAuthorizationCode": ()=>generateAuthorizationCode,
    "generateClientId": ()=>generateClientId,
    "generateClientSecret": ()=>generateClientSecret,
    "generateCodeChallenge": ()=>generateCodeChallenge,
    "generateCodeVerifier": ()=>generateCodeVerifier,
    "generateJWT": ()=>generateJWT,
    "generateRefreshToken": ()=>generateRefreshToken,
    "generateRotationId": ()=>generateRotationId,
    "generateSessionId": ()=>generateSessionId,
    "generateSessionUrl": ()=>generateSessionUrl,
    "generateState": ()=>generateState,
    "getClientIpAddress": ()=>getClientIpAddress,
    "getUserAgent": ()=>getUserAgent,
    "hashPassword": ()=>hashPassword,
    "isDevelopment": ()=>isDevelopment,
    "isExpired": ()=>isExpired,
    "isProduction": ()=>isProduction,
    "isValidRedirectUri": ()=>isValidRedirectUri,
    "isValidUrl": ()=>isValidUrl,
    "parseSessionUrl": ()=>parseSessionUrl,
    "sanitizeAllowedOrigins": ()=>sanitizeAllowedOrigins,
    "sanitizeRedirectUris": ()=>sanitizeRedirectUris,
    "scopesToString": ()=>scopesToString,
    "stringToScopes": ()=>stringToScopes,
    "validateApiKey": ()=>validateApiKey,
    "validateClientId": ()=>validateClientId,
    "validateEmail": ()=>validateEmail,
    "validateScopes": ()=>validateScopes,
    "verifyCodeChallenge": ()=>verifyCodeChallenge,
    "verifyJWT": ()=>verifyJWT,
    "verifyPassword": ()=>verifyPassword
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jsonwebtoken$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/jsonwebtoken/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/crypto [external] (crypto, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$nanoid$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/nanoid/index.js [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$crypto$2d$js$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/crypto-js/index.js [app-route] (ecmascript)");
;
;
;
;
// JWT Configuration
const JWT_SECRET = process.env.JWT_SECRET || "your-super-secret-jwt-key";
const JWT_EXPIRES_IN = process.env.JWT_EXPIRES_IN || "7d";
// Encryption Configuration
const ENCRYPTION_KEY = process.env.ENCRYPTION_KEY || "your-32-character-encryption-key";
// OAuth Configuration
const APP_DOMAIN = process.env.APP_DOMAIN || "auth-GLAstudio.auth";
const generateJWT = (payload, expiresIn = JWT_EXPIRES_IN)=>{
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jsonwebtoken$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].sign(payload, JWT_SECRET, {
        expiresIn
    });
};
const verifyJWT = (token)=>{
    try {
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jsonwebtoken$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].verify(token, JWT_SECRET);
    } catch (error) {
        console.error("JWT verification failed:", error);
        return null;
    }
};
const decodeJWT = (token)=>{
    try {
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jsonwebtoken$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].decode(token);
    } catch (error) {
        console.error("JWT decode failed:", error);
        return null;
    }
};
const encrypt = (text)=>{
    const encrypted = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$crypto$2d$js$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].AES.encrypt(text, ENCRYPTION_KEY).toString();
    return encrypted;
};
const decrypt = (encryptedText)=>{
    try {
        const bytes = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$crypto$2d$js$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].AES.decrypt(encryptedText, ENCRYPTION_KEY);
        return bytes.toString(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$crypto$2d$js$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].enc.Utf8);
    } catch (error) {
        console.error("Decryption failed:", error);
        return "";
    }
};
const generateClientId = ()=>{
    return `gla_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$nanoid$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["nanoid"])(32)}`;
};
const generateClientSecret = ()=>{
    return __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__["default"].randomBytes(32).toString("hex");
};
const generateApiKey = ()=>{
    return `gla_api_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$nanoid$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["nanoid"])(40)}`;
};
const generateSessionId = ()=>{
    // 128-bit decoded ID as specified
    return __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__["default"].randomBytes(16).toString("hex");
};
const generateRotationId = ()=>{
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$nanoid$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["nanoid"])(16);
};
const generateAuthorizationCode = ()=>{
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$nanoid$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["nanoid"])(32);
};
const generateAccessToken = ()=>{
    return __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__["default"].randomBytes(32).toString("hex");
};
const generateRefreshToken = ()=>{
    return __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__["default"].randomBytes(32).toString("hex");
};
const generateState = ()=>{
    return __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__["default"].randomBytes(16).toString("hex");
};
const generateCodeVerifier = ()=>{
    return __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__["default"].randomBytes(32).toString("base64url");
};
const generateCodeChallenge = (verifier)=>{
    return __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__["default"].createHash("sha256").update(verifier).digest("base64url");
};
const verifyCodeChallenge = (verifier, challenge)=>{
    const computedChallenge = generateCodeChallenge(verifier);
    return computedChallenge === challenge;
};
const generateSessionUrl = (components)=>{
    const { sessionId, rotationId, loginNumber } = components;
    return `https://${APP_DOMAIN}/${sessionId}/${rotationId}/${loginNumber}`;
};
const parseSessionUrl = (url)=>{
    try {
        const urlObj = new URL(url);
        const pathParts = urlObj.pathname.split("/").filter(Boolean);
        if (pathParts.length !== 3) {
            return null;
        }
        const [sessionId, rotationId, loginNumberStr] = pathParts;
        const loginNumber = parseInt(loginNumberStr, 10);
        if (isNaN(loginNumber)) {
            return null;
        }
        return {
            sessionId,
            rotationId,
            loginNumber
        };
    } catch  {
        return null;
    }
};
const validateScopes = (requestedScopes)=>{
    const validScopes = [
        "profile",
        "email",
        "openid",
        "read:user",
        "write:user"
    ];
    return requestedScopes.filter((scope)=>validScopes.includes(scope));
};
const scopesToString = (scopes)=>{
    return scopes.join(" ");
};
const stringToScopes = (scopeString)=>{
    return validateScopes(scopeString.split(" ").filter(Boolean));
};
const isValidUrl = (url)=>{
    try {
        new URL(url);
        return true;
    } catch  {
        return false;
    }
};
const isValidRedirectUri = (uri, allowedUris)=>{
    if (!isValidUrl(uri)) {
        return false;
    }
    // Exact match or wildcard match
    return allowedUris.some((allowedUri)=>{
        if (allowedUri === uri) {
            return true;
        }
        // Support wildcard matching for subdomains
        if (allowedUri.includes("*")) {
            const pattern = allowedUri.replace(/\*/g, ".*");
            const regex = new RegExp(`^${pattern}$`);
            return regex.test(uri);
        }
        return false;
    });
};
const calculateRateLimit = (requests, windowStart, maxRequests, windowMs)=>{
    const now = new Date();
    const windowEnd = new Date(windowStart.getTime() + windowMs);
    if (now > windowEnd) {
        // Window has expired, reset
        return {
            allowed: true,
            remaining: maxRequests - 1,
            resetTime: new Date(now.getTime() + windowMs),
            limit: maxRequests
        };
    }
    const allowed = requests < maxRequests;
    const remaining = Math.max(0, maxRequests - requests - (allowed ? 1 : 0));
    return {
        allowed,
        remaining,
        resetTime: windowEnd,
        limit: maxRequests
    };
};
const validateEmail = (email)=>{
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
};
const validateClientId = (clientId)=>{
    return /^gla_[a-zA-Z0-9_-]{32}$/.test(clientId);
};
const validateApiKey = (apiKey)=>{
    return /^gla_api_[a-zA-Z0-9_-]{40}$/.test(apiKey);
};
const addMinutes = (date, minutes)=>{
    return new Date(date.getTime() + minutes * 60000);
};
const addHours = (date, hours)=>{
    return new Date(date.getTime() + hours * 3600000);
};
const addDays = (date, days)=>{
    return new Date(date.getTime() + days * 86400000);
};
const isExpired = (expiryDate)=>{
    return new Date() > expiryDate;
};
const createOAuthError = (error, description, state)=>{
    const errorResponse = {
        error
    };
    if (description) {
        errorResponse.error_description = description;
    }
    if (state) {
        errorResponse.state = state;
    }
    return errorResponse;
};
const getClientIpAddress = (request)=>{
    const forwarded = request.headers.get("x-forwarded-for");
    const realIp = request.headers.get("x-real-ip");
    const cfConnectingIp = request.headers.get("cf-connecting-ip");
    if (cfConnectingIp) return cfConnectingIp;
    if (realIp) return realIp;
    if (forwarded) return forwarded.split(",")[0].trim();
    return "unknown";
};
const getUserAgent = (request)=>{
    return request.headers.get("user-agent") || "unknown";
};
const hashPassword = async (password)=>{
    const bcrypt = await __turbopack_context__.r("[project]/node_modules/bcryptjs/index.js [app-route] (ecmascript, async loader)")(__turbopack_context__.i);
    const saltRounds = 12;
    return bcrypt.hash(password, saltRounds);
};
const verifyPassword = async (password, hash)=>{
    const bcrypt = await __turbopack_context__.r("[project]/node_modules/bcryptjs/index.js [app-route] (ecmascript, async loader)")(__turbopack_context__.i);
    return bcrypt.compare(password, hash);
};
const createSuccessResponse = (data, message)=>{
    return {
        success: true,
        data,
        message
    };
};
const createErrorResponse = (error, message)=>{
    return {
        success: false,
        error,
        message
    };
};
const createSecurityLogData = (action, success, request, userId, credentialId, error, metadata)=>{
    return {
        action,
        success,
        ip: getClientIpAddress(request),
        userAgent: getUserAgent(request),
        userId,
        credentialId,
        error,
        metadata
    };
};
const isDevelopment = ()=>{
    return ("TURBOPACK compile-time value", "development") === "development";
};
const isProduction = ()=>{
    return ("TURBOPACK compile-time value", "development") === "production";
};
const sanitizeRedirectUris = (uris)=>{
    return uris.split(",").map((uri)=>uri.trim()).filter((uri)=>uri.length > 0 && isValidUrl(uri));
};
const sanitizeAllowedOrigins = (origins)=>{
    return origins.split(",").map((origin)=>origin.trim()).filter((origin)=>origin.length > 0);
};
/**
 * Export all utilities as default
 */ const utils = {
    generateJWT,
    verifyJWT,
    decodeJWT,
    encrypt,
    decrypt,
    generateClientId,
    generateClientSecret,
    generateApiKey,
    generateSessionId,
    generateRotationId,
    generateAuthorizationCode,
    generateAccessToken,
    generateRefreshToken,
    generateState,
    generateCodeVerifier,
    generateCodeChallenge,
    verifyCodeChallenge,
    generateSessionUrl,
    parseSessionUrl,
    validateScopes,
    scopesToString,
    stringToScopes,
    isValidUrl,
    isValidRedirectUri,
    calculateRateLimit,
    validateEmail,
    validateClientId,
    validateApiKey,
    addMinutes,
    addHours,
    addDays,
    isExpired,
    createOAuthError,
    getClientIpAddress,
    getUserAgent,
    hashPassword,
    verifyPassword,
    createSuccessResponse,
    createErrorResponse,
    createSecurityLogData,
    isDevelopment,
    isProduction,
    sanitizeRedirectUris,
    sanitizeAllowedOrigins
};
const __TURBOPACK__default__export__ = utils;
}),
"[project]/src/lib/rateLimiter.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "RateLimiter": ()=>RateLimiter,
    "createApiRateLimitMiddleware": ()=>createApiRateLimitMiddleware,
    "createRateLimitHeaders": ()=>createRateLimitHeaders,
    "createRateLimitMiddleware": ()=>createRateLimitMiddleware,
    "default": ()=>__TURBOPACK__default__export__
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/utils.ts [app-route] (ecmascript)");
;
class RateLimiter {
    store = {};
    cleanupInterval = null;
    defaultConfig;
    constructor(defaultConfig){
        this.defaultConfig = {
            maxRequests: parseInt(process.env.RATE_LIMIT_MAX_REQUESTS || "100", 10),
            windowMs: parseInt(process.env.RATE_LIMIT_WINDOW_MS || "900000", 10),
            enabled: true,
            ...defaultConfig
        };
        // Start cleanup interval (run every 5 minutes)
        this.startCleanup();
    }
    /**
   * Check if a request should be rate limited
   */ async checkRateLimit(identifier, config) {
        const options = {
            ...this.defaultConfig,
            ...config
        };
        if (!options.enabled) {
            return {
                allowed: true,
                remaining: options.maxRequests,
                resetTime: new Date(Date.now() + options.windowMs),
                limit: options.maxRequests
            };
        }
        const key = options.keyGenerator ? options.keyGenerator(identifier) : identifier;
        const now = new Date();
        // Get or create rate limit entry
        let entry = this.store[key];
        if (!entry || this.isWindowExpired(entry, options.windowMs)) {
            // Create new or reset expired entry
            entry = {
                requests: 0,
                windowStart: now,
                lastRequest: now
            };
            this.store[key] = entry;
        }
        // Calculate rate limit result
        const result = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["calculateRateLimit"])(entry.requests, entry.windowStart, options.maxRequests, options.windowMs);
        // Update entry if request is allowed
        if (result.allowed) {
            entry.requests += 1;
            entry.lastRequest = now;
        }
        return result;
    }
    /**
   * Record a request for rate limiting
   */ async recordRequest(identifier, success = true, config) {
        const options = {
            ...this.defaultConfig,
            ...config
        };
        if (!options.enabled) {
            return;
        }
        // Skip recording based on configuration
        if (success && options.skipSuccessfulRequests) {
            return;
        }
        if (!success && options.skipFailedRequests) {
            return;
        }
        const key = options.keyGenerator ? options.keyGenerator(identifier) : identifier;
        const now = new Date();
        let entry = this.store[key];
        if (!entry || this.isWindowExpired(entry, options.windowMs)) {
            entry = {
                requests: 1,
                windowStart: now,
                lastRequest: now
            };
            this.store[key] = entry;
        } else {
            entry.requests += 1;
            entry.lastRequest = now;
        }
    }
    /**
   * Get current rate limit status without incrementing
   */ async getRateLimitStatus(identifier, config) {
        const options = {
            ...this.defaultConfig,
            ...config
        };
        const key = options.keyGenerator ? options.keyGenerator(identifier) : identifier;
        const entry = this.store[key];
        if (!entry || this.isWindowExpired(entry, options.windowMs)) {
            return {
                allowed: true,
                remaining: options.maxRequests,
                resetTime: new Date(Date.now() + options.windowMs),
                limit: options.maxRequests
            };
        }
        return (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["calculateRateLimit"])(entry.requests, entry.windowStart, options.maxRequests, options.windowMs);
    }
    /**
   * Reset rate limit for a specific identifier
   */ async resetRateLimit(identifier, config) {
        const options = {
            ...this.defaultConfig,
            ...config
        };
        const key = options.keyGenerator ? options.keyGenerator(identifier) : identifier;
        delete this.store[key];
    }
    /**
   * Get rate limit configuration for API credentials
   */ getConfigForCredentials(credentials) {
        return {
            maxRequests: credentials.rateLimit.maxRequests,
            windowMs: credentials.rateLimit.windowMs,
            enabled: credentials.rateLimit.enabled
        };
    }
    /**
   * Check rate limit specifically for API credentials
   */ async checkApiCredentialsRateLimit(credentials, operation = "general") {
        const config = this.getConfigForCredentials(credentials);
        const key = `api:${credentials.id}:${operation}`;
        return this.checkRateLimit(key, config);
    }
    /**
   * Record API request for credentials
   */ async recordApiRequest(credentials, success = true, operation = "general") {
        const config = this.getConfigForCredentials(credentials);
        const identifier = `${credentials.clientId}:${operation}`;
        await this.recordRequest(identifier, success, config);
    }
    /**
   * Global rate limiting (per IP address)
   */ async checkGlobalRateLimit(ipAddress, config) {
        const globalConfig = {
            maxRequests: 1000,
            windowMs: 3600000,
            enabled: true,
            ...config
        };
        return this.checkRateLimit(`global:${ipAddress}`, globalConfig);
    }
    /**
   * User-specific rate limiting
   */ async checkUserRateLimit(userId, config) {
        const userConfig = {
            maxRequests: 500,
            windowMs: 3600000,
            enabled: true,
            ...config
        };
        return this.checkRateLimit(`user:${userId}`, userConfig);
    }
    /**
   * Check if rate limit window has expired
   */ isWindowExpired(entry, windowMs) {
        const now = new Date();
        const windowEnd = new Date(entry.windowStart.getTime() + windowMs);
        return now > windowEnd;
    }
    /**
   * Start cleanup process for expired entries
   */ startCleanup() {
        // Run cleanup every 5 minutes
        this.cleanupInterval = setInterval(()=>{
            this.cleanup();
        }, 5 * 60 * 1000);
    }
    /**
   * Clean up expired entries from memory
   */ cleanup() {
        const now = new Date();
        const keysToDelete = [];
        for (const [key, entry] of Object.entries(this.store)){
            // Remove entries that haven't been used in the last hour
            const inactiveThreshold = new Date(now.getTime() - 3600000); // 1 hour
            if (entry.lastRequest < inactiveThreshold) {
                keysToDelete.push(key);
            }
        }
        keysToDelete.forEach((key)=>{
            delete this.store[key];
        });
        if (keysToDelete.length > 0) {
            console.log(`Rate limiter cleaned up ${keysToDelete.length} expired entries`);
        }
    }
    /**
   * Get current store statistics
   */ getStats() {
        const entries = Object.values(this.store);
        const now = new Date();
        const activeThreshold = new Date(now.getTime() - 3600000); // 1 hour
        const activeEntries = entries.filter((entry)=>entry.lastRequest >= activeThreshold);
        const timestamps = entries.map((entry)=>entry.lastRequest);
        return {
            totalEntries: entries.length,
            activeEntries: activeEntries.length,
            oldestEntry: timestamps.length > 0 ? new Date(Math.min(...timestamps.map((t)=>t.getTime()))) : null,
            newestEntry: timestamps.length > 0 ? new Date(Math.max(...timestamps.map((t)=>t.getTime()))) : null
        };
    }
    /**
   * Clear all rate limit data
   */ clearAll() {
        this.store = {};
    }
    /**
   * Stop the rate limiter and cleanup
   */ stop() {
        if (this.cleanupInterval) {
            clearInterval(this.cleanupInterval);
            this.cleanupInterval = null;
        }
        this.clearAll();
    }
}
// Create singleton instance
const rateLimiter = new RateLimiter();
;
const __TURBOPACK__default__export__ = rateLimiter;
const createRateLimitMiddleware = (config)=>{
    return async (request, identifier)=>{
        return rateLimiter.checkRateLimit(identifier, config);
    };
};
const createApiRateLimitMiddleware = ()=>{
    return async (credentials, operation)=>{
        return rateLimiter.checkApiCredentialsRateLimit(credentials, operation);
    };
};
const createRateLimitHeaders = (result)=>{
    return {
        "X-RateLimit-Limit": result.limit.toString(),
        "X-RateLimit-Remaining": result.remaining.toString(),
        "X-RateLimit-Reset": Math.ceil(result.resetTime.getTime() / 1000).toString()
    };
};
}),
"[project]/src/app/api/credentials/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "GET": ()=>GET,
    "OPTIONS": ()=>OPTIONS,
    "POST": ()=>POST
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/firebase.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$rateLimiter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/rateLimiter.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/utils.ts [app-route] (ecmascript)");
;
;
;
;
async function GET(request) {
    const clientIp = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getClientIpAddress"])(request);
    const searchParams = request.nextUrl.searchParams;
    const userId = searchParams.get('userId');
    try {
        if (!userId) {
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["logSecurityEvent"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createSecurityLogData"])('credentials_list', false, request, undefined, undefined, 'Missing userId parameter'));
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createErrorResponse"])('userId parameter is required'), {
                status: 400
            });
        }
        // Verify user exists
        const user = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getUser"])(userId);
        if (!user) {
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["logSecurityEvent"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createSecurityLogData"])('credentials_list', false, request, userId, undefined, 'User not found'));
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createErrorResponse"])('User not found'), {
                status: 404
            });
        }
        // Check rate limiting for this user
        const rateLimitResult = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$rateLimiter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].checkUserRateLimit(userId);
        if (!rateLimitResult.allowed) {
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["logSecurityEvent"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createSecurityLogData"])('credentials_list', false, request, userId, undefined, 'Rate limit exceeded'));
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createErrorResponse"])('Rate limit exceeded. Please try again later.'), {
                status: 429
            });
        }
        // Get user's API credentials
        const credentials = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getUserApiCredentials"])(userId);
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["logSecurityEvent"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createSecurityLogData"])('credentials_list', true, request, userId, undefined, undefined, {
            credentialsCount: credentials.length
        }));
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createSuccessResponse"])(credentials, 'Credentials retrieved successfully'));
    } catch (error) {
        console.error('Get credentials error:', error);
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["logSecurityEvent"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createSecurityLogData"])('credentials_list', false, request, userId || undefined, undefined, 'Internal server error', {
            error: error instanceof Error ? error.message : 'Unknown error'
        }));
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createErrorResponse"])('Internal server error'), {
            status: 500
        });
    }
}
async function POST(request) {
    const clientIp = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getClientIpAddress"])(request);
    try {
        const body = await request.json();
        const { userId, name, description, redirectUris, allowedOrigins, scopes, rateLimit: rateLimitConfig } = body;
        // Validate required fields
        if (!userId || !name || !redirectUris) {
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["logSecurityEvent"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createSecurityLogData"])('credentials_create', false, request, userId, undefined, 'Missing required fields', {
                body: {
                    ...body,
                    userId: '[REDACTED]'
                }
            }));
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createErrorResponse"])('Missing required fields: userId, name, redirectUris'), {
                status: 400
            });
        }
        // Verify user exists
        const user = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getUser"])(userId);
        if (!user) {
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["logSecurityEvent"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createSecurityLogData"])('credentials_create', false, request, userId, undefined, 'User not found'));
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createErrorResponse"])('User not found'), {
                status: 404
            });
        }
        // Check rate limiting for this user
        const rateLimitResult = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$rateLimiter$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].checkUserRateLimit(userId, {
            maxRequests: 10,
            windowMs: 3600000
        });
        if (!rateLimitResult.allowed) {
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["logSecurityEvent"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createSecurityLogData"])('credentials_create', false, request, userId, undefined, 'Rate limit exceeded'));
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createErrorResponse"])('Rate limit exceeded. Please try again later.'), {
                status: 429
            });
        }
        // Validate and sanitize redirect URIs
        const sanitizedRedirectUris = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sanitizeRedirectUris"])(redirectUris);
        if (sanitizedRedirectUris.length === 0) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createErrorResponse"])('At least one valid redirect URI is required'), {
                status: 400
            });
        }
        // Validate and sanitize allowed origins
        const sanitizedAllowedOrigins = allowedOrigins ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sanitizeAllowedOrigins"])(allowedOrigins) : [];
        // Validate scopes
        const validatedScopes = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["validateScopes"])(scopes || []);
        if (validatedScopes.length === 0) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createErrorResponse"])('At least one valid scope is required'), {
                status: 400
            });
        }
        // Validate rate limit configuration
        const maxRequests = rateLimitConfig?.maxRequests || 1000;
        const windowMs = rateLimitConfig?.windowMs || 3600000; // 1 hour
        if (maxRequests < 1 || maxRequests > 10000) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createErrorResponse"])('Max requests must be between 1 and 10,000'), {
                status: 400
            });
        }
        if (windowMs < 60000 || windowMs > 86400000) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createErrorResponse"])('Window must be between 1 minute and 24 hours'), {
                status: 400
            });
        }
        // Validate name length
        if (name.length < 1 || name.length > 100) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createErrorResponse"])('Name must be between 1 and 100 characters'), {
                status: 400
            });
        }
        // Validate description length if provided
        if (description && description.length > 500) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createErrorResponse"])('Description must be less than 500 characters'), {
                status: 400
            });
        }
        // Generate credentials
        const clientId = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateClientId"])();
        const clientSecret = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateClientSecret"])();
        const apiKey = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateApiKey"])();
        // Create credential data
        const credentialData = {
            userId,
            clientId,
            clientSecret,
            apiKey,
            name: name.trim(),
            description: description?.trim() || undefined,
            redirectUris: sanitizedRedirectUris,
            allowedOrigins: sanitizedAllowedOrigins,
            scopes: validatedScopes,
            isActive: true,
            lastUsed: undefined,
            rateLimit: {
                maxRequests,
                windowMs,
                enabled: true
            }
        };
        // Create the credentials in the database
        const credentialId = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createApiCredentials"])(credentialData);
        // Create the response credential object
        const newCredential = {
            id: credentialId,
            ...credentialData,
            createdAt: new Date(),
            updatedAt: new Date()
        };
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["logSecurityEvent"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createSecurityLogData"])('credentials_create', true, request, userId, credentialId, undefined, {
            name,
            clientId,
            apiKey,
            scopes: validatedScopes,
            redirectUris: sanitizedRedirectUris,
            rateLimit: {
                maxRequests,
                windowMs
            }
        }));
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createSuccessResponse"])(newCredential, 'API credentials created successfully'), {
            status: 201
        });
    } catch (error) {
        console.error('Create credentials error:', error);
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["logSecurityEvent"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createSecurityLogData"])('credentials_create', false, request, undefined, undefined, 'Internal server error', {
            error: error instanceof Error ? error.message : 'Unknown error'
        }));
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createErrorResponse"])('Internal server error'), {
            status: 500
        });
    }
}
async function OPTIONS(request) {
    return new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"](null, {
        status: 200,
        headers: {
            'Access-Control-Allow-Origin': '*',
            'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
            'Access-Control-Allow-Headers': 'Content-Type, Authorization'
        }
    });
}
}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__428f2224._.js.map