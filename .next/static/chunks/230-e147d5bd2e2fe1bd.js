(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[230],{477:()=>{},3747:(e,t,s)=>{"use strict";s.d(t,{Cv:()=>n,wV:()=>c});var r=s(2109),i=s.n(r),o=s(9509);let a={sessionCookieName:"glasstudio_session",refreshCookieName:"glasstudio_refresh",sessionDuration:864e5,refreshDuration:6048e5,cookieOptions:{httpOnly:!0,secure:!0,sameSite:"lax",path:"/"}};class n{static getInstance(){return n.instance||(n.instance=new n),n.instance}generateSessionId(){let e=Date.now().toString(),t=Math.random().toString(36).substring(2);return i().SHA256(e+t).toString()}getSessionSecret(){let e=o.env.NEXT_PUBLIC_SESSION_SECRET||o.env.SESSION_SECRET||"glasstudio-default-secret-key-2024";return e.includes("default")&&console.warn("Using default session secret. Please set NEXT_PUBLIC_SESSION_SECRET in production."),e}encryptData(e){try{let t=this.getSessionSecret();return i().AES.encrypt(e,t).toString()}catch(e){throw console.error("Session encryption error:",e),Error("Failed to encrypt session data")}}decryptData(e){try{let t=this.getSessionSecret(),s=i().AES.decrypt(e,t).toString(i().enc.Utf8);if(!s)throw Error("Decryption resulted in empty string");return s}catch(e){throw console.error("Session decryption error:",e),Error("Failed to decrypt session data")}}debugSession(e,t){}createSession(e){try{var t;let s=new Date,r=new Date(s.getTime()+a.sessionDuration),i={userId:e.uid,email:e.email||"",displayName:e.displayName||void 0,photoURL:e.photoURL||void 0,provider:(null==(t=e.providerData[0])?void 0:t.providerId)==="google.com"?"google":"email",emailVerified:e.emailVerified,createdAt:s.toISOString(),expiresAt:r.toISOString(),lastActivity:s.toISOString(),sessionId:this.generateSessionId()};return this.debugSession("Creating new session",{userId:e.uid,email:e.email}),this.sessionData=i,this.saveSessionToCookies(i),this.startRefreshTimer(),this.debugSession("Session created successfully",{sessionId:i.sessionId}),i}catch(e){throw console.error("Failed to create session:",e),e}}saveSessionToCookies(e){let t=this.encryptData(JSON.stringify(e));e.sessionId,e.userId,Date.now(),new Date(e.expiresAt).getTime();let s={sessionId:e.sessionId,userId:e.userId,issuedAt:Date.now(),expiresAt:Date.now()+a.refreshDuration,type:"refresh"};document.cookie="".concat(a.sessionCookieName,"=").concat(t,"; max-age=").concat(a.sessionDuration/1e3,"; path=/; ").concat(a.cookieOptions.secure?"secure;":""," samesite=").concat(a.cookieOptions.sameSite);let r=this.encryptData(JSON.stringify(s));document.cookie="".concat(a.refreshCookieName,"=").concat(r,"; max-age=").concat(a.refreshDuration/1e3,"; path=/; ").concat(a.cookieOptions.secure?"secure;":""," samesite=").concat(a.cookieOptions.sameSite)}getSessionFromCookies(){let e=document.cookie.split(";").reduce((e,t)=>{let[s,r]=t.trim().split("=");return e[s]=r,e},{})[a.sessionCookieName];if(!e)return null;try{let t=this.decryptData(e),s=JSON.parse(t);if(new Date(s.expiresAt)<new Date)return this.clearSession(),null;return s.lastActivity=new Date().toISOString(),this.sessionData=s,this.saveSessionToCookies(s),s}catch(e){return console.error("Failed to parse session cookie:",e),this.clearSession(),null}}getCurrentSession(){return this.sessionData&&new Date(this.sessionData.expiresAt)>new Date?this.sessionData:this.getSessionFromCookies()}async refreshSession(){let e=document.cookie.split(";").reduce((e,t)=>{let[s,r]=t.trim().split("=");return e[s]=r,e},{})[a.refreshCookieName];if(!e)return null;try{let t=this.decryptData(e),s=JSON.parse(t);if(s.expiresAt<Date.now())return this.clearSession(),null;let r=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:s})});if(r.ok){let{sessionData:e}=await r.json();return this.sessionData=e,this.saveSessionToCookies(e),e}}catch(e){console.error("Failed to refresh session:",e)}return this.clearSession(),null}clearSession(){this.sessionData=null,this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null),document.cookie="".concat(a.sessionCookieName,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"),document.cookie="".concat(a.refreshCookieName,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;")}startRefreshTimer(){this.refreshTimer&&clearTimeout(this.refreshTimer);let e=a.sessionDuration-3e5;this.refreshTimer=setTimeout(async()=>{await this.refreshSession(),this.startRefreshTimer()},e)}isAuthenticated(){return null!==this.getCurrentSession()}getCurrentUser(){let e=this.getCurrentSession();return e?{uid:e.userId,email:e.email,displayName:e.displayName,photoURL:e.photoURL,emailVerified:e.emailVerified}:null}updateActivity(){this.sessionData&&(this.sessionData.lastActivity=new Date().toISOString(),this.saveSessionToCookies(this.sessionData))}constructor(){this.sessionData=null,this.refreshTimer=null}}function c(){let e=n.getInstance();return{getSession:()=>e.getCurrentSession(),clearSession:()=>e.clearSession(),isAuthenticated:()=>e.isAuthenticated(),getCurrentUser:()=>e.getCurrentUser(),updateActivity:()=>e.updateActivity(),sessionManager:e}}},6080:(e,t,s)=>{"use strict";let r;s.d(t,{BP:()=>S,Bh:()=>m,DW:()=>y,G6:()=>d,Ru:()=>h,Ts:()=>g,bk:()=>p});var i=s(3915),o=s(5404),a=s(5317);r=(0,i.Dk)().length?(0,i.Dk)()[0]:(0,i.Wp)({apiKey:"AIzaSyDAupXvxYn4UQQmqPxUQGYwQ551N20ILpk",authDomain:"itdiary-ase.firebaseapp.com",projectId:"itdiary-ase",storageBucket:"itdiary-ase.firebasestorage.app",messagingSenderId:"889720897004",appId:"1:889720897004:web:c614ece867e0cb6f0a94c9"});let n=(0,o.xI)(r),c=(0,a.aU)(r),u=new o.HF;u.addScope("profile"),u.addScope("email");let l={USERS:"users"},d=async()=>{try{return(await (0,o.df)(n,u)).user}catch(e){throw console.error("Google sign-in error:",e),e}},h=async(e,t)=>{try{return(await (0,o.x9)(n,e,t)).user}catch(e){throw console.error("Email sign-in error:",e),e}},p=async(e,t,s)=>{try{let r=await (0,o.eJ)(n,e,t);return s&&r.user&&await (0,o.r7)(r.user,{displayName:s}),r.user}catch(e){throw console.error("Email sign-up error:",e),e}},S=async()=>{try{await (0,o.CI)(n)}catch(e){throw console.error("Sign-out error:",e),e}},m=e=>(0,o.hg)(n,e),g=async e=>{try{var t;let s={email:e.email,displayName:e.displayName,photoURL:e.photoURL,provider:(null==(t=e.providerData[0])?void 0:t.providerId)||"email",emailVerified:e.emailVerified,createdAt:a.Dc.now(),updatedAt:a.Dc.now(),lastLoginAt:a.Dc.now()};await (0,a.BN)((0,a.H9)(c,l.USERS,e.uid),s,{merge:!0})}catch(e){console.error("Error saving user data:",e)}},y=e=>{if(!(null==e?void 0:e.code))return"An unknown error occurred";switch(e.code){case"auth/user-not-found":return"No user found with this email address";case"auth/wrong-password":return"Incorrect password";case"auth/email-already-in-use":return"An account with this email already exists";case"auth/weak-password":return"Password should be at least 6 characters";case"auth/invalid-email":return"Please enter a valid email address";case"auth/too-many-requests":return"Too many failed attempts. Please try again later";case"auth/popup-closed-by-user":return"Sign-in popup was closed before completing";case"auth/popup-blocked":return"Sign-in popup was blocked by the browser";case"auth/configuration-not-found":return"Firebase configuration not found. Please check your environment variables.";default:return e.message||"An error occurred"}}}}]);